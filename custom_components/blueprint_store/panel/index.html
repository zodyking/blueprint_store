<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>Blueprint Store</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <!-- Shoelace (Web Components) -->
    <script type="module"
      src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.15.0/cdn/shoelace-autoloader.js">
    </script>

    <!-- Material Web (filter chips if we ever show “active” chips inline) -->
    <script type="module">
      import 'https://esm.run/@material/web@1.0.0/chips/filter-chip.js';
    </script>

    <style>
      :root{
        /* Brand + base */
        --blue-1:#0a5bd8; --blue-2:#0d3b8e; --ink:#e6f0ff; --muted:#b9c7e6;
        --card-bg: rgba(6,18,54,0.65);
        --card-bd: rgba(255,255,255,0.16);
        --panel-bg: rgba(10,26,70,.92);
        --shadow: 0 10px 30px rgba(0,0,0,.35);
        --maxw: 1200px;

        /* Shoelace tokens (make inputs opaque) */
        --sl-input-background-color: rgba(14,30,76,0.95);
        --sl-input-border-color: rgba(255,255,255,.18);
        --sl-panel-background-color: rgba(16,34,86,.98);
      }

      /* Page */
      body{
        margin:0; color:var(--ink);
        font-family: ui-sans-serif, system-ui, Segoe UI, Roboto, Ubuntu;
        background: linear-gradient(180deg, var(--blue-1), var(--blue-2));
        min-height:100vh;
      }
      /* Blueprint grid overlay */
      body::after{
        content:""; position:fixed; inset:0; z-index:-1; pointer-events:none;
        background-image:
          linear-gradient(to right, rgba(255,255,255,.12) 1px, transparent 1px),
          linear-gradient(to bottom, rgba(255,255,255,.12) 1px, transparent 1px);
        background-size: 28px 28px;
      }

      /* Header */
      header{ position:sticky; top:0; z-index:5; backdrop-filter:blur(8px); border-bottom:1px solid #ffffff22; }
      .bar{
        max-width:var(--maxw); margin:0 auto; padding:8px 12px;
        display:grid; grid-template-columns:auto 1fr auto; gap:10px; align-items:center;
      }
      .brand{ display:flex; gap:10px; align-items:center; font-weight:900; }
      .brand img{ width:28px; height:28px; border-radius:6px; }

      /* Layout */
      main{ max-width:var(--maxw); margin:12px auto 40px; padding:0 12px; }
      .layout{ display:grid; grid-template-columns: 280px 1fr; gap:18px; }

      /* Sidebar */
      aside{
        position:sticky; top:72px;
        background: var(--panel-bg);
        border:1px solid var(--card-bd);
        border-radius:16px; box-shadow: var(--shadow);
        padding:14px;
        height: fit-content;
      }
      .side-title{ font-weight:900; margin:0 0 10px; }
      .side-group{ margin-bottom:14px; }
      .tag-list{ display:flex; flex-direction:column; gap:6px; max-height: 42vh; overflow:auto; padding-right:6px; }
      .side-row{ display:flex; gap:8px; align-items:center; }

      /* Content */
      .banner{ margin:8px 0 14px; border-radius:16px; overflow:hidden; box-shadow:var(--shadow); border:1px solid #ffffff22; }
      .banner img{ width:100%; display:block; }
      .section-title{ margin:10px 0 8px; font-size:20px; font-weight:900; letter-spacing:.2px; }

      /* Cards wrapper with glowing track */
      .cards-wrap{ position:relative; }
      .cards-wrap::before{
        content:""; position:absolute; inset:-40px -20px -40px -20px; z-index:-1;
        background: radial-gradient(60% 50% at 50% 10%, rgba(155,205,255,.18), transparent 60%),
                    radial-gradient(60% 60% at 50% 100%, rgba(40,140,255,.18), transparent 65%);
        filter: blur(18px);
      }

      /* Card */
      .card{
        background: var(--card-bg);
        border:1px solid var(--card-bd);
        border-radius:18px;
        box-shadow: 0 18px 40px rgba(5,12,40,.45);
        padding:16px; margin:12px 0;
      }
      .card:hover{ border-color:#9dd1ff55; box-shadow: 0 22px 50px rgba(30,140,255,.28); }
      .row{ display:flex; gap:10px; align-items:baseline; flex-wrap:wrap; }
      .card h3{ margin:0; font-size:18px; font-weight:900; }
      .author{ opacity:.9; font-weight:700; }
      .desc{ color:var(--muted); margin:8px 0 12px; line-height:1.55; }
      .uses{ background:#ffffff22; border:1px solid #ffffff33; border-radius:999px; padding:3px 8px; font-weight:700; }

      /* My Home Assistant–style Import button (inspired) */
      .myha-btn{
        --grad-a:#00b2ff; --grad-b:#0a84ff;
        display:inline-flex; align-items:center; gap:8px;
        padding:10px 14px; border-radius:999px; font-weight:800;
        color:#032149; text-decoration:none;
        background: linear-gradient(135deg, var(--grad-a), var(--grad-b));
        box-shadow: 0 10px 24px rgba(4,96,200,.35), inset 0 1px 0 #fff6;
        border: 1px solid rgba(255,255,255,.35);
      }
      .myha-btn:active{ transform: translateY(1px); }

      #error, #empty{ text-align:center; color:#e7eefc; }
      #sentinel{ height:60px; }

      /* Make Shoelace dropdowns non-transparent */
      sl-select::part(combobox){ background: var(--sl-input-background-color); }
      sl-select::part(listbox){ background: var(--sl-panel-background-color); }
      sl-input::part(base){ background: var(--sl-input-background-color); }
    </style>
  </head>
  <body>
    <!-- Sticky top bar -->
    <header>
      <div class="bar">
        <div class="brand">
          <img src="/blueprint_store_static/images/bps_logo.png" alt="Blueprint Store"/>
          <span>Blueprint Store</span>
        </div>

        <sl-input id="search" placeholder="Search titles (finds every match)..." clearable pill>
          <sl-icon name="search" slot="prefix"></sl-icon>
        </sl-input>

        <sl-button id="refresh" variant="primary" pill>Refresh</sl-button>
      </div>
    </header>

    <main>
      <div class="layout">
        <!-- Sidebar filters -->
        <aside>
          <h3 class="side-title">Filters</h3>

          <div class="side-group">
            <div class="side-row">
              <strong>Sort</strong>
              <sl-select id="sort" value="new" hoist style="flex:1">
                <sl-option value="new">Newest</sl-option>
                <sl-option value="title">Title A–Z</sl-option>
                <sl-option value="uses">Most used</sl-option>
              </sl-select>
            </div>
          </div>

          <div class="side-group">
            <strong>Tags</strong>
            <div class="tag-list" id="tags-list"><!-- sl-checkbox items injected --></div>
          </div>

          <div class="side-group">
            <sl-button id="clear-filters" caret>Clear filters</sl-button>
          </div>
        </aside>

        <!-- Content -->
        <section>
          <div class="banner"><img src="/blueprint_store_static/images/bps_banner.png" alt="Blueprint Store banner"></div>

          <div class="section-title">Top 10</div>
          <div id="top10" class="cards-wrap"></div>

          <div class="section-title" style="margin-top:16px">All blueprints</div>
          <div id="list" class="cards-wrap"></div>

          <p id="empty" style="display:none">No blueprints matched.</p>
          <p id="error" style="display:none"></p>
          <div id="sentinel"></div>
        </section>
      </div>
    </main>

    <!-- IMPORTANT: module so we can use top-level await in app.js -->
    <script type="module" src="./app.js"></script>
  </body>
</html>
